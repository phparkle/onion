{"version":3,"file":"onion.cjs","sources":["../src/onion.ts"],"sourcesContent":["interface OnionElement extends HTMLElement {\n  onion?: {\n    abort?: () => void;\n  }\n}\n\ninterface ClassList {\n  [key: string]: boolean;\n}\n\nfunction setClasses(el: Element, classes: ClassList) {\n  Object.entries(classes)\n    .filter(([key]) => key.length)\n    .forEach(([key, value]) => el.classList.toggle(key, value));\n}\n\nfunction addEndListener(el: Element, listener: () => void) {\n  el.addEventListener(\"transitionend\", listener);\n  el.addEventListener(\"animationend\", listener);\n}\n\nfunction removeEndListener(el: Element, listener: () => void) {\n  el.removeEventListener(\"transitionend\", listener);\n  el.removeEventListener(\"animationend\", listener);\n}\n\nfunction show(el: OnionElement, token: string = \"\") {\n  if (!(el instanceof HTMLElement)) return;\n\n  if (el.classList.contains(\"is-opening\"))\n    return;\n\n  el.onion?.abort?.();\n\n  if (token === \"is-opening\")\n    token = \"\";\n\n  const handleEnd = (event?: Event) => {\n    if (event?.target !== el) return;\n\n    setClasses(el, {\n      \"is-open\": true,\n      \"is-opening\": true,\n      \"is-closing\": false,\n      [token]: false,\n    });\n    el.onion?.abort?.();\n  }\n\n  const timeoutID = setTimeout(handleEnd, 2000);\n\n  el.onion = Object.assign(el.onion || {}, {\n    abort: () => {\n      removeEndListener(el, handleEnd);\n      clearTimeout(timeoutID);\n      setClasses(el, { [token]: false });\n      delete el.onion?.abort;\n    }\n  });\n\n  addEndListener(el, handleEnd);\n\n  setClasses(el, {\n    \"is-open\": true,\n    \"is-opening\": false,\n    \"is-closing\": false,\n    [token]: false,\n  });\n\n  setTimeout(() => setClasses(el, {\n    \"is-open\": true,\n    \"is-opening\": true,\n    \"is-closing\": false,\n    [token]: true,\n  }));\n}\n\nfunction hide(el: OnionElement, token: string = \"\") {\n  if (!(el instanceof HTMLElement)) return;\n\n  if (el.classList.contains(\"is-closing\") || !el.classList.contains(\"is-open\"))\n    return;\n\n  el.onion?.abort?.();\n\n  if (token === \"is-closing\")\n    token = \"\";\n\n  const handleEnd = (event?: Event) => {\n    if (event?.target !== el) return;\n\n    setClasses(el, {\n      \"is-open\": false,\n      \"is-opening\": false,\n      \"is-closing\": false,\n      [token]: false,\n    });\n    el.onion?.abort?.();\n  }\n\n  const timeoutID = setTimeout(handleEnd, 2000);\n\n  el.onion = Object.assign(el.onion || {}, {\n    abort: () => {\n      removeEndListener(el, handleEnd);\n      clearTimeout(timeoutID);\n      setClasses(el, { [token]: false });\n      delete el.onion?.abort;\n    }\n  });\n\n  addEndListener(el, handleEnd);\n\n  setClasses(el, {\n    \"is-open\": true,\n    \"is-opening\": false,\n    \"is-closing\": true,\n    [token]: true,\n  });\n}\n\nfunction toggle(el: OnionElement, force?: boolean, openingToken: string = \"\", closingToken: string = \"\") {\n  if (!(el instanceof HTMLElement)) return;\n\n  if (typeof force === 'undefined') {\n    if (el.classList.contains('is-opening')) {\n      hide(el, closingToken);\n    } else {\n      show(el, openingToken);\n    }\n  } else {\n    if (force) show(el, openingToken);\n    else hide(el, closingToken);\n  }\n}\n\nexport default {\n  show,\n  hide,\n  toggle\n};\n"],"names":["setClasses","el","classes","Object","entries","filter","_ref","length","forEach","key","classList","toggle","_ref2","addEndListener","listener","addEventListener","removeEndListener","removeEventListener","show","token","_el$onion","_setClasses3","HTMLElement","contains","abort","onion","handleEnd","event","_setClasses","_el$onion2","target","timeoutID","setTimeout","assign","clearTimeout","_setClasses2","_el$onion3","_setClasses4","hide","_el$onion4","_setClasses7","_setClasses5","_el$onion5","_setClasses6","_el$onion6","force","openingToken","closingToken"],"mappings":"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"}